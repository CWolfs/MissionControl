(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{133:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"rightToc",(function(){return r})),n.d(t,"metadata",(function(){return l})),n.d(t,"default",(function(){return u}));var a=n(2),o=n(6),s=(n(0),n(280)),i={id:"encounter-rulesets",title:"Encounter Rulesets"},r=[{value:"Example Ruleset",id:"example-ruleset",children:[]},{value:"Example Walkthrough",id:"example-walkthrough",children:[{value:"Set up the right special superclass",id:"set-up-the-right-special-superclass",children:[]},{value:"Create a build step",id:"create-a-build-step",children:[]},{value:"Specify Custom Logic",id:"specify-custom-logic",children:[]},{value:"Build Spawns",id:"build-spawns",children:[]},{value:"Link Object References",id:"link-object-references",children:[]}]},{value:"Send Your Custom Ruleset To Mission Control",id:"send-your-custom-ruleset-to-mission-control",children:[]},{value:"Summary",id:"summary",children:[]}],l={id:"features/encounter-rulesets",title:"Encounter Rulesets",description:"Mission Control allows other modders to add their own contract type rulesets to be used. When added to the mod, the mod will randomly select a ruleset for a contract type from the given choices.\r",source:"@site/docs\\features\\encounter-rulesets.md",permalink:"/docs/features/encounter-rulesets",sidebar:"docs",previous:{title:"Random Spawns",permalink:"/docs/features/random-spawns"},next:{title:"Extended Lances",permalink:"/docs/features/extended-lances"}},c={rightToc:r,metadata:l};function u(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(s.b)("wrapper",Object(a.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(s.b)("p",null,"Mission Control allows other modders to add their own contract type rulesets to be used. When added to the mod, the mod will randomly select a ruleset for a contract type from the given choices."),Object(s.b)("p",null,"Encounter Rulesets are what control the manipulation of a mission/contract. To manipulate encounters you create lots of ",Object(s.b)("inlineCode",{parentName:"p"},"Logic")," objects and submit them to the ",Object(s.b)("inlineCode",{parentName:"p"},"EncounterLogic")," system. Mission Control then intelligently runs these logic blocks at the correct point as the game runs."),Object(s.b)("h2",{id:"example-ruleset"},"Example Ruleset"),Object(s.b)("p",null,"Below is an example of the ",Object(s.b)("inlineCode",{parentName:"p"},"AssassinateEncounterRules")," used in Mission Control. We'll run through each bit of code to explain what is happening."),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-clike"}),'using BattleTech;\n\nusing MissionControl.Logic;\n\nnamespace MissionControl.Rules {\n  public class AssassinateEncounterRules : EncounterRules {\n    public AssassinateEncounterRules() : base() { }\n\n    public override void Build() {\n      Main.Logger.Log("[AssassinateEncounterRules] Setting up rule object references");\n      BuildRandomSpawns();\n      BuildAdditionalLances("AssassinateSpawn", SpawnLogic.LookDirection.AWAY_FROM_TARGET,\n        "SpawnerPlayerLance", SpawnLogic.LookDirection.AWAY_FROM_TARGET, 25f, 100f);\n    }\n\n    public void BuildRandomSpawns() {\n      if (!MissionControl.Instance.IsRandomSpawnsAllowed()) return;\n\n      Main.Logger.Log("[AssassinateEncounterRules] Building spawns rules");\n      EncounterLogic.Add(new SpawnLanceAtEdgeOfBoundary(this, "SpawnerPlayerLance", "AssassinateSpawn"));\n      EncounterLogic.Add(new SpawnLanceAnywhere(this, "AssassinateSpawn", "SpawnerPlayerLance", 400, true));\n      EncounterLogic.Add(new LookAtTarget(this, "SpawnerPlayerLance", "AssassinateSpawn", true));\n    }\n\n    public override void LinkObjectReferences(string mapName) {\n      ObjectLookup["AssassinateSpawn"] = EncounterLayerData.gameObject.FindRecursive("Lance_Enemy_AssassinationTarget");\n    }\n  }\n}\n')),Object(s.b)("h2",{id:"example-walkthrough"},"Example Walkthrough"),Object(s.b)("h3",{id:"set-up-the-right-special-superclass"},"Set up the right special superclass"),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-clike"}),"public class AssassinateEncounterRules : EncounterRules {\n")),Object(s.b)("p",null,"To create a ruleset you must create a class and extend the ",Object(s.b)("inlineCode",{parentName:"p"},"EncounterRules")," superclass. This provides lots of inbuilt functionality useful for encounters and allows Mission Control to use it."),Object(s.b)("h3",{id:"create-a-build-step"},"Create a build step"),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-clike"}),'public override void Build() {\n  Main.Logger.Log("[AssassinateEncounterRules] Setting up rule object references");\n  BuildSpawns();\n  BuildAdditionalLances("AssassinateSpawn", SpawnLogic.LookDirection.AWAY_FROM_TARGET,\n    "SpawnerPlayerLance", SpawnLogic.LookDirection.AWAY_FROM_TARGET, 25f, 100f);\n}\n')),Object(s.b)("p",null,"This is a special method which is required. It is called by Mission Control at the appropriate time to create the initial configuration. From here you can chain into your own methods for organisational purposes. I've used it to chain on Ai, Spawns and the special hook for ",Object(s.b)("inlineCode",{parentName:"p"},"Additional Lances")," support for this contract type."),Object(s.b)("p",null,"The ",Object(s.b)("inlineCode",{parentName:"p"},"EncounterRules")," superclass gives you access to an easy way of enabling ",Object(s.b)("inlineCode",{parentName:"p"},"Additional Lances")," for your encounter. Here is the method hook explained in more detail."),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-clike"}),"BuildAdditionalLances(TargetKeyToSpawnEnemyLancesAround, DirectionToLookAtInRelationToEnemyTarget, TargetKeyToSpawnAllyLancesAround,\n  DirectionToLookAtInRelationToAllyTarget, MinDistanceForAlliesToSpawnFromAllyTarget, MaxistanceForAlliesToSpawnFromAllyTarget);\n")),Object(s.b)("p",null,"The target keys are bound at the bottom of the class with the ",Object(s.b)("inlineCode",{parentName:"p"},"LinkObjectReferences")," method. This will be explained in a moment."),Object(s.b)("h3",{id:"specify-custom-logic"},"Specify Custom Logic"),Object(s.b)("p",null,"You can specify custom logic to be applied in a contract type. You can do this as follows:"),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-clike"}),"public void BuildCustomLogic() { // any method name, then call it from the Build() method\n  EncounterLogic.Add(new MyCustomLogic());\n}\n")),Object(s.b)("p",null,"This method is for organisational purposes only. You can set up your custom logic in a method similar to this."),Object(s.b)("p",null,"Two things are happening here. Firstly, you would have previously created a custom logic block which contains your logic. Secondly, you add this logic block relating to your custom logic to the ",Object(s.b)("inlineCode",{parentName:"p"},"EncounterLogic")," property that is provided by the superclass ",Object(s.b)("inlineCode",{parentName:"p"},"EncounterRules")," your class has access to. The ",Object(s.b)("inlineCode",{parentName:"p"},"EncounterLogic")," list contains logic blocks of different type and that execute at different points in the game depending on their type. The main types are:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"RESOURCE_REQUEST"),Object(s.b)("li",{parentName:"ul"},"CONTRACT_OVERRIDE_MANIPULATION"),Object(s.b)("li",{parentName:"ul"},"ENCOUNTER_MANIPULATION"),Object(s.b)("li",{parentName:"ul"},"SCENE_MANIPULATION")),Object(s.b)("p",null,"and these types are executed in that order depending on when the game requires them to be executed."),Object(s.b)("h3",{id:"build-spawns"},"Build Spawns"),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-clike"}),'public void BuildSpawns() {\n  Main.Logger.Log("[AssassinateEncounterRules] Building spawns rules");\n  EncounterLogic.Add(new SpawnLanceAtEdgeOfBoundary(this, "SpawnerPlayerLance", "AssassinateSpawn"));\n  EncounterLogic.Add(new SpawnLanceAnywhere(this, "AssassinateSpawn", "SpawnerPlayerLance", 400, true));\n  EncounterLogic.Add(new LookAtTarget(this, "SpawnerPlayerLance", "AssassinateSpawn", true));\n}\n')),Object(s.b)("p",null,"This method is for organisational purposes only. You can set up your spawn logic in a method similar to this."),Object(s.b)("p",null,"Mission Control provides four spawn logic blocks to be used to move targets around the map. They are:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"SpawnLanceAnywhere"),Object(s.b)("li",{parentName:"ul"},"SpawnLanceAroundTarget"),Object(s.b)("li",{parentName:"ul"},"SpawnLanceMembersAroundTarget"),Object(s.b)("li",{parentName:"ul"},"SpawnLanceAtEdgeBoundary")),Object(s.b)("p",null,"and there are two orientation logic blocks of:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"LookAtTarget"),Object(s.b)("li",{parentName:"ul"},"LookAwayFromTarget")),Object(s.b)("p",null,"For each of these you provide different arguments but they all are very similar. You provide the target you wish to move around, the target you wish to be the orientation target (e.g to look at after being moved and to pathfind check to) and sometimes provide the look type (TOWARDS ORIENTATION TARGET, AWAY FROM ORIENTATION TARGET), minimum and maximum spawn distance constraints."),Object(s.b)("h3",{id:"link-object-references"},"Link Object References"),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-clike"}),'public override void LinkObjectReferences(string mapName) {\n  ObjectLookup.Add("AssassinateSpawn", EncounterLayerData.gameObject.FindRecursive("Lance_Enemy_AssassinationTarget"));\n}\n')),Object(s.b)("p",null,"This is a very important method. Almost every logic block requires the use of keys to identify which item to move around the game map. This is how those keys are linked up to the game objects in the game scene / map. In this example, we assign the object found under the ",Object(s.b)("inlineCode",{parentName:"p"},"EncounterLayerData")," object in the Unity game scene which has the name ",Object(s.b)("inlineCode",{parentName:"p"},"Lance_Enemy_AssassinationTarget"),", which is a spawner object for the encounter, to the key ",Object(s.b)("inlineCode",{parentName:"p"},"AssassinateSpawn"),"."),Object(s.b)("p",null,"You may notice there is no ",Object(s.b)("inlineCode",{parentName:"p"},"SpawnerPlayerLance")," entry. This is because ",Object(s.b)("inlineCode",{parentName:"p"},"SpawnerPlayerLance")," is a special key that is auto-linked for you already. It will always be available for you to use."),Object(s.b)("p",null,"To discover the name and unity game scene location of the object to link I highly recommend you use the mod ",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/CWolfs/BTDebug"}),"BTDebug")," with the latest releases found in the ",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/CWolfs/BTDebug/releases"}),"Releases")," area. It has a runtime inspector that allows you to view what objects are in the game scene / map so you can correctly link up what you need."),Object(s.b)("h2",{id:"send-your-custom-ruleset-to-mission-control"},"Send Your Custom Ruleset To Mission Control"),Object(s.b)("p",null,"You're able to provide your custom ruleset to Mission Control and it will use it. Mission Control randomly selects from all the available rulesets for a particular contract type."),Object(s.b)("p",null,"To do this you must first create your own ruleset by linking your mod to ",Object(s.b)("inlineCode",{parentName:"p"},"MissionControl.dll")," then creating it as explained above. Then, in your mod code execute code similar to the below example:"),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-clike"}),'MissionControl.Instance.AddEncounter("Assassinate", typeof(MyCustomAssassinateRuleset));  // Add a custom assassinate ruleset\n')),Object(s.b)("p",null,"If for whatever reason you wish to only have your custom rulesets running you can clear all loaded rulesets with the following code:"),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-clike"}),"MissionControl.Instance.ClearEncounters();  // Clears all encounters for all contract types\n")),Object(s.b)("p",null,"and"),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-clike"}),"MissionControl.Instance.ClearEncounters(\"Assassinate\");  // Clears all encounters for only the 'Assassinate' contract type\n")),Object(s.b)("h2",{id:"summary"},"Summary"),Object(s.b)("p",null,"It's worth reviewing the code of this mod to see what already happens for the default encounter rulesets, especially looking at the ",Object(s.b)("inlineCode",{parentName:"p"},"EncounterRules.cs")," class to see what the mod already provides for you to use (e.g. it contains properties that link to the encounter object in the Unity game scene you can use)."))}u.isMDXComponent=!0},280:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return u}));var a=n(0),o=n.n(a),s=o.a.createContext({}),i=function(e){var t=o.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):Object.assign({},t,e)),n},r=function(e){var t=i(e.components);return o.a.createElement(s.Provider,{value:t},e.children)};var l={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},c=Object(a.forwardRef)((function(e,t){var n=e.components,a=e.mdxType,s=e.originalType,r=e.parentName,c=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&-1===t.indexOf(a)&&(n[a]=e[a]);return n}(e,["components","mdxType","originalType","parentName"]),u=i(n),p=a,d=u[r+"."+p]||u[p]||l[p]||s;return n?o.a.createElement(d,Object.assign({},{ref:t},c,{components:n})):o.a.createElement(d,Object.assign({},{ref:t},c))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=n.length,i=new Array(s);i[0]=c;var r={};for(var l in t)hasOwnProperty.call(t,l)&&(r[l]=t[l]);r.originalType=e,r.mdxType="string"==typeof e?e:a,i[1]=r;for(var u=2;u<s;u++)i[u]=n[u];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,n)}c.displayName="MDXCreateElement"}}]);